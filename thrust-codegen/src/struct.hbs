#[derive(Debug, Clone, PartialEq, Eq, PartialOrd, Ord)]
pub struct {{struct.ident}} {
    {{~#each struct.fields as |field|}}
    pub {{field.ident}}: {{to_rust field.ty}}
    {{~/each}}
}

impl Serialize for {{struct.ident}} {
    fn serialize<S>(&self, s: &mut S) -> Result<(), Error>
        where S: Serializer + ThriftSerializer
    {
        try!(s.write_struct_begin("{{struct.ident}}"));
        {{#each struct.fields as |field|~}}
        try!(s.write_field_begin("{{arg.field}}", {{to_protocol field.ty}}, {{field.seq}}));
        try!(self.{{field.ident}}.serialize(s));
        try!(s.write_field_end());
        {{~/each}}
        try!(s.write_field_stop());
        try!(s.write_struct_end());
        Ok(())
    }
}


impl Deserialize for {{struct.ident}} {
    fn deserialize<D>(de: &mut D) -> Result<Self, Error>
        where D: Deserializer + ThriftDeserializer,
    {
        try!(de.read_struct_begin());
        {{~#each struct.fields as |field|}}
        let mut {{field.ident}} = None;
        {{~/each}}
        loop {
            let scheme_field = try!(de.read_field_begin());
            if scheme_field.ty == ThriftType::Stop {
                break;
            };
            match scheme_field.seq {
                {{~#each struct.fields as |field|}}
                {{field.seq}} => {
                    if scheme_field.ty == {{to_protocol field.ty}} {
                        {{field.ident}} = Some(try!({{expr field.ty}}));
                    } else {
                        // skip
                    }
                },
                {{~/each}}
                _ => (),// skip
            }
            try!(de.read_field_end());
        };
        try!(de.read_struct_end());
        let args = {{struct.ident}} {
            {{~#each struct.fields as |field|}}
            {{field.ident}}: {{field.ident}}.unwrap(),
            {{~/each}}
        };
        Ok(args)
    }
}
